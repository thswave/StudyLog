# strace

운영중인 서비스가 DB를 쓰지않고 간단하게 파일에 저장하는데 트래픽이 증가하면서 병목이 발생해서 이를 찾기위해 여러가지 시도를 했고 그 경험을 적고자 함
그 중에서 결론부에 해당하는 strace에 대해 먼저 정리하고자 합니다

strace 

system call을 trace 할 수 있는 리눅스 명령어!
서버에서 실행되는 프로세스가 실제 어떤 시스템 콜을 호출하는지 자세하게 알 수 있다
단, 너무 많은 시스템 콜을 단시간에 출력되므로 당황할 수 있다.

`strace ls`
실행하면 ls 명령어가 호출하는 시스템 콜을 확인할 수 있다.

그럼 본론으로 들어가서  자바 어플리케이션의 로그를 살펴ㅗ니 disk write 부분이 느린것 같아 테스트

-f: childe processes 같이 추적
-o: 결과 파일
-T: 소요된 시간 출력
-p: pid를 trace
-e: regex로 특정 시스템 콜만 확인할 수 있다.

`strace -f -T -e write <app 실행 명령어>`

* 회고

결과가 너무 많이 출력되 해당 부분을 찾아내기도 어려웠다. 
자바 어플리케이션을 운영하면서 시스템콜 까지 추적하는 경험을 해 보았다
파일 입출력이 서버의 하드디스크 성능 또는 라이브러리와 서버와의 궁합? 등 최적화된 서비스를 위해 여러가지 테스트가 필요하다는걸 깨달았다.





참고 

[http://linuxspot.tistory.com/253](http://linuxspot.tistory.com/253)